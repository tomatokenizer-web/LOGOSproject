# 태스크 모듈 (Tasks Module)

> **최종 업데이트**: 2026-01-04
> **코드 위치**: `src/core/tasks/`
> **상태**: 활성화
> **구현**: Gap 4.6 - 전통적 태스크 유형 라이브러리

---

## 태스크 모듈 인덱스 (Barrel Export)

### 컨텍스트 및 목적

이 파일은 전체 태스크 모듈의 **중앙 내보내기 허브**(일반적으로 "배럴 내보내기(barrel export)"라고 함)입니다. LOGOS 언어 학습 애플리케이션의 모든 태스크 관련 기능에 대해 깔끔하고 체계적인 공개 API를 제공합니다.

**비즈니스 요구사항**: 언어 학습 플랫폼을 구축할 때 다양한 유형의 연습 문제(독해, 빈칸 채우기, 오류 수정 등)가 필요합니다. 애플리케이션의 다른 모든 부분이 어떤 파일에 어떤 기능이 있는지 정확히 기억하도록 강요하는 대신, 이 모듈은 모든 것을 한 곳에 모읍니다. 대형 오피스 빌딩의 안내 데스크처럼 생각하면 됩니다 - 올바른 부서를 찾아 복도를 돌아다니는 대신 안내 데스크에 물어보면 안내해 줍니다.

**해결된 문제**: 배럴 내보내기가 없으면 태스크 기능을 가져오려면 내부 파일 구조를 알아야 합니다:

```typescript
// 배럴 없이 (지저분하고 취약함)
import { TRADITIONAL_TASK_TYPES } from '../core/tasks/traditional-task-types';
import { TaskConstraintSolver } from '../core/tasks/task-constraint-solver';
import { DistractorGenerator } from '../core/tasks/distractor-generator';

// 배럴 사용 (깔끔하고 안정적)
import { TRADITIONAL_TASK_TYPES, TaskConstraintSolver, DistractorGenerator } from '../core/tasks';
```

**사용 시점**: LOGOS의 어떤 부분이든 태스크와 작업해야 할 때마다 - 연습 문제 생성, 연습용 어휘 선택, 객관식 옵션 생성, 또는 학습자의 현재 수준에 맞는 활동 유형 결정 시.

---

### 마이크로스케일: 직접적 관계

#### 의존성 (이 모듈이 필요로 하는 것)

이 배럴 파일은 세 개의 내부 모듈에서 다시 내보냅니다:

- **`./traditional-task-types.ts`**: 30개 태스크 유형 정의 라이브러리
  - 타입: `TaskCategory`, `TraditionalTaskType`, `CognitiveProcess`, `ResponseFormat`, `TraditionalTaskTypeMeta`
  - 데이터: `TRADITIONAL_TASK_TYPES` - 30개 모든 태스크 유형에 대한 완전한 메타데이터
  - 함수: `getTaskTypesByCategory()`, `getTaskTypesForStage()`, `getTaskTypesForIntent()`, `getTaskTypesForComponent()`, `getProductiveTaskTypes()`, `getReceptiveTaskTypes()`, `calculateTaskSuitability()`, `selectOptimalTaskType()`

- **`./task-constraint-solver.ts`**: 객체 선택 엔진
  - 타입: `ObjectSelectionConstraints`, `ScoredObject`, `SelectionResult`, `CollocationPair`
  - 클래스: `TaskConstraintSolver` - 메인 솔버 클래스
  - 함수: `createConstraintSolver()`, `selectObjectsForTask()`

- **`./distractor-generator.ts`**: MCQ 오답 생성기
  - 타입: `DistractorStrategy`, `Distractor`, `DistractorConfig`, `DistractorSet`
  - 클래스: `DistractorGenerator` - 그럴듯한 오답 생성
  - 함수: `createDistractorGenerator()`, `generateDistractors()`

#### 의존자 (이 모듈을 필요로 하는 것)

학습 활동을 생성하거나 관리하는 모든 모듈:

- **태스크 생성 서비스**: 적절한 연습 문제 생성을 위해 태스크 유형 사용
- **콘텐츠 선택 파이프라인**: 적합한 어휘 선택을 위해 제약조건 솔버 사용
- **퀴즈/테스트 생성기**: 객관식 문제를 위해 오답 생성기 사용
- **적응형 학습 엔진**: 활동을 학습자 수준에 맞추기 위해 태스크 적합성 점수 사용
- **UI 컴포넌트**: 연습 문제 인터페이스 렌더링을 위해 태스크 유형 메타데이터 가져오기

#### 데이터 흐름

```
외부 모듈 요청
        |
        v
  [index.ts] (이 파일)
        |
        +---> traditional-task-types.ts (태스크 메타데이터 및 선택)
        |
        +---> task-constraint-solver.ts (객체 매칭)
        |
        +---> distractor-generator.ts (오답 생성)
```

---

### 매크로스케일: 시스템 통합

#### 아키텍처 역할

이 모듈은 LOGOS 3계층 아키텍처의 **코어 알고리즘 레이어**에 위치합니다:

```
+--------------------------------------------------+
|  RENDERER (UI 레이어)                              |
|  연습 문제 표시를 위한 React 컴포넌트               |
+--------------------------------------------------+
                        |
                        v
+--------------------------------------------------+
|  CORE (알고리즘 레이어) <-- 현재 위치               |
|  - tasks/index.ts (이 파일)                       |
|  - IRT 능력 추정                                   |
|  - FSRS 간격 반복                                  |
|  - PMI 연어 점수                                   |
+--------------------------------------------------+
                        |
                        v
+--------------------------------------------------+
|  MAIN (데이터 레이어)                              |
|  데이터베이스, IPC 핸들러, 서비스                   |
+--------------------------------------------------+
```

태스크 모듈은 **순수 알고리즘 코드**입니다 - 데이터베이스 접근, UI 렌더링, Electron 특정 로직이 없습니다. 이로 인해:
- 격리된 상태에서 테스트 가능
- 다른 플랫폼으로 이식 가능
- 이해하기 쉬움

#### 전체 시스템 영향

태스크 모듈은 LOGOS의 **교육학적 두뇌**입니다. 중요한 질문에 답합니다:

1. **"이 학습자에게 다음에 어떤 종류의 연습 문제를 줄까?"**
   - `selectOptimalTaskType()`은 숙달 단계, 목표 스킬, 다양성을 고려합니다

2. **"이 연습 문제에 어떤 단어가 나와야 할까?"**
   - `TaskConstraintSolver`는 어휘를 태스크 요구사항에 맞춥니다

3. **"객관식 문제에 어떤 오답이 있어야 할까?"**
   - `DistractorGenerator`는 그럴듯하지만 틀린 옵션을 만듭니다

**이 모듈 없이는** LOGOS가 다음을 할 수 없습니다:
- 적절한 학습 활동 생성
- 학습자 수준에 맞는 어휘 선택
- 의미 있는 객관식 문제 생성
- 참여도 유지를 위한 연습 문제 유형 다양화

#### 시스템 의존성

**중요도 수준**: 핵심 경로 (Critical Path)

이 모듈은 **의존성 허브**입니다 - 많은 시스템이 필요로 하지만, 외부 시스템은 거의 필요하지 않습니다. 다음에만 의존합니다:
- 코어 타입 정의 (`../types`)
- 교육학적 의도 시스템 (`../content/pedagogical-intent`)

이 모듈이 실패하면:
- 연습 문제를 생성할 수 없음
- 적응형 학습 루프가 중단됨
- 사용자가 학습 콘텐츠를 볼 수 없음

**폴백**: `selectOptimalTaskType()` 함수는 점수 계산이 실패할 경우 `'cloze_deletion'`으로 하드코딩된 폴백이 있어 시스템이 항상 *무언가*를 생성할 수 있습니다.

---

### 이 모듈이 내보내는 것

#### 전통적 태스크 유형 (6개 카테고리에 걸친 30개 유형)

언어 학습 연습 문제 유형의 완전한 분류법:

| 카테고리 | 개수 | 설명 | 예시 |
|----------|------|------|------|
| **수용적 (Receptive)** | 5 | 생성 없이 이해 | 독해, 청취 이해 |
| **생산적 (Productive)** | 5 | 능동적 언어 생성 | 에세이 작성, 받아쓰기, 자유 응답 |
| **변환적 (Transformative)** | 7 | 형태 간 변환 | 번역, 바꿔 쓰기, 태 변환 |
| **빈칸 채우기 (Fill-in)** | 4 | 갭 완성 연습 | 클로즈 삭제, 단어 은행 채우기 |
| **상호작용 (Interactive)** | 4 | 대화 및 응답 | 역할극, 질문 답변 |
| **분석적 (Analytical)** | 5 | 오류 감지 및 분석 | 오류 수정, 문법 식별 |

각 태스크 유형에는 풍부한 메타데이터가 포함됩니다:
- 관여하는 **인지 과정** (인식, 회상, 종합 등)
- **숙달 범위** (어떤 학습자 단계에 적합한지)
- **구성요소 초점** (음운적, 형태적, 어휘적, 통사적, 화용적)
- **난이도 및 인지 부하** 등급
- **응답 형식** (객관식, 타이핑, 오디오 녹음 등)

#### 태스크 제약조건 솔버 (Task Constraint Solver)

태스크에 적합한 어휘를 선택하는 **제약조건 만족 엔진**(여러 요구사항을 동시에 만족하는 솔루션을 찾는 시스템).

주요 기능:
- 숙달 단계, 도메인, 구성요소별 객체 필터링
- 난이도 적합성, 최신성, 복습 예정 상태에 대한 객체 점수화
- 필요 시 연어(collocation) 쌍이 함께 나타나도록 보장
- 디버깅을 위한 거부 이유와 함께 순위가 매겨진 결과 반환

#### 오답 생성기 (Distractor Generator)

언어학적 전략을 사용하여 객관식 문제의 **그럴듯한 오답**을 생성합니다:

| 전략 | 설명 | 예시 |
|------|------|------|
| `phonological_similar` | 비슷하게 들리는 | "their" vs "there" |
| `orthographic_similar` | 비슷한 철자 | "affect" vs "effect" |
| `semantic_related` | 같은 카테고리 | "apple" vs "orange" (둘 다 과일) |
| `morphological_variant` | 다른 형태 | "run" vs "running" |
| `common_confusion` | L1 간섭 | "make" vs "do" (스페인어 화자) |
| `translation_false_friend` | 거짓 동족어 | "actual" (스페인어: 현재의) |

---

### 기술 개념 (쉬운 설명)

#### 배럴 내보내기 (Barrel Export)
**기술적**: 단일 `index.ts` 파일이 여러 내부 파일의 심볼을 다시 내보내어 통합된 공개 API를 만드는 모듈 패턴.

**쉬운 설명**: 백화점 1층과 같습니다 - 고객이 신발과 전자제품을 파는 층을 알 필요 없이 입구에 안내판이 있어 모든 것을 가리킵니다. 내부 재구성(층 간 부서 이동)이 모든 고객의 머릿속 지도를 업데이트할 필요가 없습니다.

**사용 이유**: 태스크 모듈의 내부 구조가 변경되어도 이를 가져오는 모든 파일을 깨뜨리지 않습니다.

#### 제약조건 만족 (Constraint Satisfaction)
**기술적**: 점수화와 제거를 사용하여 여러 제약조건을 동시에 만족하는 값을 찾는 것.

**쉬운 설명**: 매칭 서비스처럼: 근처에 살고, 취미가 같고, 연령대가 맞고, 주말에 시간이 있는 사람을 찾습니다. 단일 기준만으로는 충분하지 않고 여러 개를 한 번에 만족해야 합니다.

**사용 이유**: 태스크를 위한 어휘 선택은 숙달 수준, 구성요소 초점, 도메인, 난이도를 모두 동시에 만족해야 합니다.

#### 오답 그럴듯함 (Distractor Plausibility)
**기술적**: 틀린 답이 틀리면서도 잠재적으로 맞아 보일 필요성의 균형을 맞추는 0-1 측정값.

**쉬운 설명**: 거짓말 탐지기 테스트처럼 - 틀린 답은 자료를 모르는 사람이 속을 수 있을 만큼 좋은 거짓말이어야 하지만, 문제가 불공평해질 정도로 명백해서는 안 됩니다.

**사용 이유**: 너무 쉬운 오답은 진정한 지식을 테스트하지 않고, 너무 어려운 오답은 학습자를 좌절시킵니다. 그럴듯함 점수가 난이도를 조정하는 데 도움이 됩니다.

#### 인지 부하 (Cognitive Load)
**기술적**: 작업 기억 요구에 따라 1-5 척도로 측정되는 태스크 완료에 필요한 정신적 노력.

**쉬운 설명**: 물리적 무게와 같습니다 - 어떤 연습은 가볍고(인식 태스크), 다른 것들은 무거운 리프팅입니다(에세이 작성). 막 훈련을 시작한 사람에게 300파운드 데드리프트를 요청하지 않습니다.

**사용 이유**: 인지 부하를 학습자 용량에 맞추면 압도와 지루함을 방지합니다.

---

### 변경 이력

#### 2026-01-04 - 초기 구현
- **변경 내용**: Gap 4.6을 구현하는 태스크 모듈용 배럴 내보내기 생성
- **이유**: 연습 문제 생성을 위한 중앙집중식 태스크 유형 라이브러리 필요
- **영향**: 전체 애플리케이션에서 적응형 태스크 선택 가능

---

## 전통적 태스크 유형 (Traditional Task Types) - 30개 태스크 분류법

### 존재 이유

언어 학습 연구는 다양한 인지 과정과 언어적 구성요소를 대상으로 하는 별개의 연습 유형을 식별했습니다. 태스크 형식을 임의로 만드는 대신, 이 모듈은 언어 교육학 문헌에서 30개의 전통적 태스크 유형을 체계화하고, 알고리즘적 선택을 가능하게 하는 메타데이터로 각각 주석을 달았습니다: 어떤 숙달 단계에 적합한지, 어떤 인지 부하를 부과하는지, 생산이 필요한지 아니면 인식만 필요한지.

이 분류법은 시스템이 "다음에 어떤 종류의 연습 문제를 줄까?"에 대해 이야기하는 데 사용하는 어휘입니다.

### 핵심 개념

- **TaskCategory**: 30개 유형을 정리하는 6개 카테고리:
  - `receptive` (5개 유형): 생산 없이 이해 (독해, 청취)
  - `productive` (5개 유형): 언어 출력 생성 (쓰기, 말하기)
  - `transformative` (7개 유형): 형태 간 변환 (번역, 바꿔 쓰기)
  - `fill_in` (4개 유형): 갭 완성 (클로즈, 단어 은행)
  - `interactive` (4개 유형): 대화 및 응답 (Q&A, 역할극)
  - `analytical` (5개 유형): 메타언어적 분석 (오류 수정, 문법 식별)

- **CognitiveProcess**: 언어에 적응된 블룸의 분류법(Bloom's taxonomy)에서 8개 과정:
  - `recognition`, `recall` (하위 차수)
  - `comprehension`, `application` (중간 차수)
  - `analysis`, `synthesis`, `evaluation` (상위 차수)
  - `automatization` (유창성 관련)

- **TraditionalTaskTypeMeta**: 태스크 유형별 풍부한 메타데이터 포함:
  - `masteryRange`: 이 태스크가 적합한 단계 (0-4)
  - `cognitiveLoad`: 필요한 정신적 노력 (1-5)
  - `scaffoldingLevel`: 일반적으로 필요한 지원 수준 (0-3)
  - `needsDistractors`: MCQ 스타일 오답 옵션 필요 여부
  - `requiresProduction`: 수용적 vs. 생산적 구분

- **특징 벡터 태스크 선택 (z(w) 매칭)**: 객체의 언어적 특징 벡터를 사용한 고급 선택. 높은 형태적 점수는 단어 형성 태스크를 제안하고, 높은 음운적 점수는 받아쓰기를 제안합니다.

### 설계 결정

**고정 30개 유형 라이브러리**: 임의의 태스크 정의를 허용하는 대신 라이브러리가 폐쇄적입니다. 이를 통해 시스템이 태스크 속성에 대해 추론할 수 있고(예: "모든 생산적 태스크"), 코드베이스 전체에서 일관된 메타데이터를 보장합니다.

**게이트로서의 숙달 범위**: 각 태스크 유형에는 최소 및 최대 숙달 단계가 있습니다. 이는 초보자에게 에세이 작성을 주거나 고급 학습자에게 단어 은행 연습을 주는 것을 방지합니다. 제약조건 솔버는 이를 하드 필터링에 사용합니다.

**난이도와 분리된 인지 부하**: 태스크가 인지적으로 요구할 수 있지만(토론 응답: 부하 5) 낮은 난이도 콘텐츠를 가질 수 있고, 형식이 간단하지만(단어 은행: 부하 2) 어려운 어휘를 가질 수 있습니다. 이 차원들은 별도로 추적됩니다.

**기본 난이도 vs. 항목 난이도**: `baseDifficulty`는 태스크 형식의 고유한 도전입니다. 실제 난이도는 선택된 콘텐츠에도 의존합니다. 희귀 어휘가 있는 받아쓰기 태스크(기본 3)는 일반 단어가 있는 받아쓰기보다 어려워집니다.

**스캐폴딩 수준**:
- 0 = 스캐폴딩 없음 (자유 생산)
- 1 = 가벼운 스캐폴딩 (프롬프트, 예시)
- 2 = 중간 스캐폴딩 (부분 구조 제공)
- 3 = 무거운 스캐폴딩 (단어 은행, 첫 글자 제공)

이는 콘텐츠 선택을 넘어 적응형 난이도 조정을 안내합니다.

**z(w) 특징 벡터 통합**: `getTasksForFeatureVector()` 함수는 보조 선택 경로를 구현합니다. 단어의 언어적 특징(형태적 복잡성, 음운적 난이도, 연어 강도, 도메인 전문화)을 알고 있을 때, 시스템은 그 특정 특징을 연습하는 태스크 유형을 추천할 수 있습니다. 이는 전통적인 숙달 기반 선택을 넘어섭니다.

### 통합 지점

- **ComponentType** (`src/core/types.ts`): `primaryComponents` 필드는 각 태스크 유형이 연습하는 언어적 구성요소(음운적, 형태적, 어휘적, 통사적, 화용적)를 나열합니다. 구성요소 중심 연습을 위해 제약조건 솔버가 사용합니다.

- **TaskModality** (`src/core/types.ts`): 지원되는 양식(텍스트, 오디오)이 렌더링 요구사항을 결정합니다. 청취 이해는 오디오 재생이 필요하고, 받아쓰기는 오디오 입력이 필요합니다.

- **PedagogicalIntent** (`src/core/content/pedagogical-intent.ts`): `intents` 필드는 태스크 유형을 교육학적 목표(새로운 것 소개, 알려진 것 강화, 이해력 테스트, 생산 유도 등)에 매핑합니다.

- **FeatureVector** (`src/core/state/component-object-state.ts`): z(w) 벡터 (F, R, D, M, P 구성요소)는 `getTasksForFeatureVector()`를 통해 특징 기반 태스크 선택을 가능하게 합니다.

- **태스크 제약조건 솔버** (`task-constraint-solver.ts`): 태스크 유형에 대한 객체 선택 시 `masteryRange`와 `typicalItemCount`를 기본값으로 사용합니다.

- **오답 생성기** (`distractor-generator.ts`): `needsDistractors` 플래그는 어떤 태스크 유형이 오답 생성기를 호출해야 하는지 나타냅니다.

- **헬퍼 함수**: 유틸리티 함수(`getTaskTypesByCategory`, `getTaskTypesForStage`, `getTaskTypesForComponent` 등)는 모든 메타데이터 차원으로 태스크 라이브러리 필터링을 가능하게 합니다. `selectOptimalTaskType()`은 지능적인 태스크 선택을 위해 모든 요소를 결합합니다.

---

## 태스크 제약조건 솔버 (Task Constraint Solver) - 객체와 태스크 매칭

### 존재 이유

태스크 생성기는 각 연습 문제에 *어떤* 어휘 항목이 나타날지 선택해야 합니다. 이 선택은 무작위가 될 수 없습니다: 학습자의 현재 숙달 수준, 태스크의 난이도 요구사항, 도메인 관련성, 항목이 복습 예정인지를 고려해야 합니다. 제약조건 솔버는 이러한 경쟁하는 요구사항을 최적 객체의 순위가 매겨진 선택으로 변환합니다.

이것은 "학습자가 연습해야 하는 것"과 "그 필요에 맞는 콘텐츠" 사이의 다리입니다.

### 핵심 개념

- **ObjectSelectionConstraints**: 우리가 필요로 하는 것의 전체 명세:
  - 태스크 유형 및 교육학적 의도
  - 허용 오차가 있는 난이도 범위
  - 구성요소 초점 (음운적, 어휘적 등)
  - 숙달 단계 범위 (예: 1-3단계만)
  - 필수 도메인 (의료, 비즈니스 등)
  - 연어 요구사항 (함께 어울리는 단어 쌍 포함 필수)
  - 제외 목록 (최근 사용된 항목 피하기)
  - 최소/최대 객체 수

- **ScoredObject**: 각 후보는 분석과 함께 복합 점수(0-100)를 받습니다:
  - `difficultyFit` (0-25): 객체 난이도가 목표와 얼마나 잘 맞는지
  - `componentMatch` (0-20): 객체가 목표 구성요소를 연습하는지
  - `masteryFit` (0-25): 학습자의 숙달 단계와의 정렬
  - `domainFit` (0-15): 필수 도메인과의 중복
  - `recencyScore` (0-10): 최근/비최근 항목에 대한 선호도
  - `dueScore` (0-5): 간격 반복 복습 예정 항목에 대한 보너스

- **하드 vs 소프트 제약조건**: 하드 제약조건(숙달 범위, 도메인)은 즉시 거부를 유발합니다. 소프트 제약조건(난이도 적합성, 최신성)은 점수에 영향을 주지만 실격시키지 않습니다.

- **CollocationPair**: 자연스럽게 함께 나타나는 단어 쌍(예: "make decision")을 나타내며, PMI(점별 상호 정보) 강도로 인덱싱됩니다.

### 설계 결정

**2단계 필터링**: 첫 번째 패스는 특정 이유(콘텐츠 갭 디버깅에 유용)로 즉시 거부를 위한 하드 제약조건을 적용합니다. 두 번째 패스는 소프트 제약조건에 대해 남은 후보의 점수를 매깁니다. 이 분리는 점수 계산을 깔끔하게 유지합니다.

**가중 점수 공식**: 난이도와 숙달 적합이 지배합니다(각 25점) - 학습자 수준 매칭이 가장 중요하기 때문입니다. 구성요소 매치는 20점으로 타겟 연습을 위해 언어적 초점이 중요합니다. 도메인 적합은 맥락화를 위해 15점입니다. 최신성과 예정 여부는 사소한 타이브레이커입니다.

**객체 난이도 추정**: 객체에 명시적 난이도 등급이 없을 때, 솔버는 속성에서 추정합니다: 단어 길이, 빈도(역관계), 음운적 복잡성, 형태적 규칙성. 이 휴리스틱은 시스템이 최소 메타데이터로 작동할 수 있게 합니다.

**연어 보존**: `requireCollocations`가 true일 때, 솔버는 선택된 객체가 최소 하나의 자연스러운 단어 쌍을 포함하도록 보장합니다. 이는 단어 관계가 중요한 연어 판단이나 갭 채우기 같은 태스크를 지원합니다.

**양방향 연어 인덱스**: 연어는 양방향(A->B 및 B->A)으로 저장되어 쌍의 어느 단어가 먼저 선택되든 조회가 작동합니다.

### 통합 지점

- **TraditionalTaskType** (`traditional-task-types.ts`): 각 태스크 유형은 재정의되지 않으면 기본 제약조건이 되는 `masteryRange`와 `typicalItemCount`를 지정합니다.

- **PedagogicalIntent** (`src/core/content/pedagogical-intent.ts`): 의도(소개, 강화, 테스트)는 어떤 제약조건이 적용되는지에 영향을 미칩니다. 소개 태스크는 낮은 난이도를 선호할 수 있고, 테스트 태스크는 특정 숙달 단계를 요구할 수 있습니다.

- **MasteryStage** (`src/core/types.ts`): 0-4 단계 시스템(새로운 -> 숙달됨)은 어떤 태스크가 적절하고 어떤 객체를 선택해야 하는지 결정합니다.

- **DifficultyConstraints** (`src/core/content/pedagogical-intent.ts`): 최소/최대 난이도, 목표 theta(IRT 능력 추정), 목표에서 얼마나 멀어도 되는지의 허용 오차를 지정합니다.

- **간격 반복 시스템**: 숙달 상태의 `nextReview` 날짜는 `preferDue` 모드를 가능하게 하여 복습 준비된 항목에 우선순위를 두기 위해 FSRS 스케줄링과 통합합니다.

- **태스크 생성**: 팩토리 함수 `selectObjectsForTask()`는 일반적인 경우를 위한 간단한 진입점을 제공합니다. `TaskConstraintSolver` 클래스는 더 복잡한 다중 쿼리 시나리오를 허용합니다.

---

## 오답 생성기 (Distractor Generator) - MCQ를 위한 그럴듯한 오답

### 존재 이유

객관식 문제는 오답(오답, distractors)이 믿을 만하게 틀릴 때만 효과적입니다. 무작위 오답은 학습자가 추측으로 제거할 수 있게 합니다. 잘 만들어진 오답은 진정한 지식 검색을 강제합니다. 이 모듈은 무작위 선택 대신 언어학적 관계(음운적 유사성, 의미적 관련성, 형태적 변형, L1 간섭 패턴)를 사용하여 그럴듯하지만 틀린 옵션을 생성합니다.

교육학적 통찰: 학습자가 오답을 선택하면, 선택한 오답의 *유형*이 무엇을 오해하는지 드러내어 타겟 피드백을 가능하게 합니다.

### 핵심 개념

- **DistractorStrategy**: 교육학적 가치 순으로 정렬된 7개 생성 접근법:
  - `phonological_similar` — 비슷하게 들리는 단어 ("affect/effect")
  - `orthographic_similar` — 비슷하게 철자된 단어 (레벤슈타인 거리)
  - `semantic_related` — 같은 개념 필드 ("chair/table")
  - `morphological_variant` — 같은 어근의 다른 형태 ("run/running")
  - `common_confusion` — 알려진 L1 간섭 패턴
  - `random_same_pos` — 품사 매칭을 사용한 폴백
  - `translation_false_friend` — 언어 간 다른 의미를 가진 동족어

- **그럴듯함 점수 (0-1)**: 학습자가 이 오답을 선택할 가능성. 높은 점수는 더 어려운 문제를 만듭니다. 시스템은 이 임계값을 조정하여 난이도를 타겟팅합니다.

- **DistractorConfig**: 개수, 최소 그럴듯함, 선호 전략, 간섭 패턴을 위한 L1, 제외할 단어(중복 방지)를 포함한 생성 동작을 제어합니다.

- **거짓 친구 데이터베이스**: 영어 단어를 스페인어, 포르투갈어, 프랑스어, 독일어, 이탈리아어, 일본어, 중국어의 오해의 소지가 있는 동족어에 매핑하는 내장 사전. 예: "library"는 실제로 "서점"을 의미하는 스페인어 "libreria"에 매핑됩니다.

### 설계 결정

**무작위 선택보다 전략 순서**: 생성기는 무작위로 섞는 대신 선호도 순서로 전략을 시도합니다. 의미적 및 형태적 오답이 음운적 오답보다 더 많이 가르치므로 먼저 옵니다.

**폴백 체인**: 선호 전략이 충분한 오답을 생성할 수 없으면(희소 어휘, 로드된 의미 그룹 없음), 시스템은 우아하게 폴백합니다: 먼저 무작위 같은 품사 단어로, 그다음 길이가 비슷한 단어로, 마지막으로 합성 글자 대체 변형으로.

**품질 점수 계산**: 평균 그럴듯함, 전략 다양성(여러 전략 사용이 더 좋음), 목표 개수 충족을 결합합니다. 이는 태스크 생성기가 오답 세트가 교육학적으로 건전한지 평가하는 데 도움이 됩니다.

**L1별 혼동 쌍**: 일반적인 오답 대신 시스템은 스페인어 화자가 "make/do"를 혼동하고 중국어 화자가 "he/she"를 혼동한다는 것(중국어에는 성별 대명사가 없음)을 알고 있습니다. 이는 일반적인 오류를 학습 기회로 변환합니다.

**설명 필드**: 모든 오답에는 왜 틀렸는지에 대한 사람이 읽을 수 있는 설명이 포함됩니다. 이는 학습자가 오답을 선택할 때 피드백 시스템을 지원합니다.

### 통합 지점

- **LanguageObject** (`src/core/types.ts`): 대상 항목은 빈도, 도메인 분포, 음운적 난이도 메타데이터가 있는 통합 언어 객체 모델에서 옵니다.

- **ComponentType** (`src/core/types.ts`): `componentFocus` 설정 매개변수는 오답을 테스트되는 언어적 구성요소에 맞춥니다(발음 태스크를 위한 음운적 오답, 활용 태스크를 위한 형태적 오답).

- **태스크 생성 파이프라인**: 제약조건 솔버(`task-constraint-solver.ts`)가 대상 객체를 선택하고, 이 모듈이 그들의 오답을 생성합니다. 오답이 필요한 태스크(`traditional-task-types.ts`에서 `needsDistractors: true`)가 이 모듈을 호출합니다.

- **어휘 로딩**: 코퍼스 기반 전략을 위해 `loadVocabulary()`를 통한 사전 로드된 어휘가 필요합니다. 의미 그룹과 형태적 패밀리는 더 풍부한 오답 생성을 위해 별도로 로드할 수 있습니다.

- **피드백 시스템**: 각 오답의 `explanation` 필드는 학습자 피드백 렌더링과 통합되어 *왜* 그들의 선택이 틀렸는지 설명합니다.

---

## 관련 문서

- `docs/narrative/src/core/tasks/traditional-task-types.md` - 상세 태스크 유형 문서
- `docs/narrative/src/core/tasks/task-constraint-solver.md` - 제약조건 솔버 심층 분석
- `docs/narrative/src/core/tasks/distractor-generator.md` - 오답 생성 전략
- `docs/narrative/src/core/content/pedagogical-intent.md` - 의도 시스템 통합
